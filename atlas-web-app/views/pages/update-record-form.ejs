
<script>
    function populateUpdateRecordForm(id) {
        // [Grab relevant elements for readability]
        var find_form = document.getElementById('div-find-form');

        var error_section = document.getElementById('error-section');
        var error_message = document.getElementById('error-message');

        var update_form = document.getElementById('div-update-form');
        var input_id = document.getElementById('update-form-input-id');
        var input_name = document.getElementById('update-form-input-name');
        var input_url = document.getElementById('update-form-input-url');
        var input_lat = document.getElementById('update-form-input-lat');
        var input_long = document.getElementById('update-form-input-long');
        var input_ele = document.getElementById('update-form-input-ele');

        // [Clear error message and hide]
        error_message.innerHTML = "no_error";
        error_section.style = "display:none; color:red";

        // [Get record and display in update form]
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/record/' + id);
        xhr.onload = function () {
            var records = JSON.parse(xhr.responseText);
            if (xhr.readyState == 4 && xhr.status == '200') {
                // [Load update form with current record values]
                input_id.placeholder = records.id;
                input_name.placeholder = records.name;
                input_url.placeholder = records.url;
                input_lat.placeholder = records.lat;
                input_long.placeholder = records.long;
                input_ele.placeholder = records.ele;

                // [Hide find form, unhide update form and cancel button]
                find_form.style = "display:none";
                update_form.style = "display:block";

            } else {
                // [Set error message and display]
                error_message.innerHTML =
                  "Record not found. Perhaps the ID is incorrect?";

// TODO : consider adding some helpful bits here, such as:
// todo   * find similar records
// todo   * create record with given id (if conformant to UUIDv?)

                error_section.style = "display:block; color:red";
            }
        };

        xhr.send(null);
    }

    function cancelUpdate() {
        // [Grab relevant elements for readability]
        var find_form = document.getElementById('div-find-form');

        var update_form = document.getElementById('div-update-form');
        var input_id = document.getElementById('update-form-input-id');
        var input_name = document.getElementById('update-form-input-name');
        var input_url = document.getElementById('update-form-input-url');
        var input_lat = document.getElementById('update-form-input-lat');
        var input_long = document.getElementById('update-form-input-long');
        var input_ele = document.getElementById('update-form-input-ele');

        // ["Zero out" update form]
        input_id.placeholder = "";
        input_name.placeholder = "";
        input_url.placeholder = "";
        input_lat.placeholder = "";
        input_long.placeholder = "";
        input_ele.placeholder = "";

        // [hide update form, unhide find form]
        update_form.style = "display:none";
        find_form.style = "display:block";

    }
</script>

<!-- TODO: replace w autogen version of pseudo filesystem header -->
<a href="/home">ATLAS Home</a> <a>/</a> <a href="manage">ATLAS Management</a> <a>/</a> <a>Find & Update Record</a> <a>&gt;</a>

<h1>
    Find Record and Update
</h1>

<div id="div-find-form" style="display:block">
<form>
    ID:
    <br/>
    <input type="text" name="id" id="find-form-input-id" required>

    <button
      type="button"
      onclick="populateUpdateRecordForm(
               document.getElementById('find-form-input-id').value);"
    >
    Find Record
    </button>

</form>
</div>

<!-- TODO : take "color" out of div since it has to be repeated in js above -->
<div id="error-section" style="display:none;color:red">
  <p id="error-message">no_error</p>
</div>

<div id="div-update-form" style="display:none">
<form action="record" method="post">
    ID:<br/>
    <input type="text" name="id" id="update-form-input-id" disabled><br/><br/>
    Name:<br/>
    <input type="text" name="name" id="update-form-input-name"><br/><br/>
    URL:<br/>
    <input type="text" name="url" id="update-form-input-url"><br/><br/>
    Latitude:<br/>
    <input type="text" name="lat" id="update-form-input-lat"><br/><br/>
    Longitude:<br/>
    <input type="text" name="long" id="update-form-input-long"><br/><br/>
    Elevation:<br/>
    <input type="text" name="ele" id="update-form-input-ele"><br/><br/>
    <button type="button" onclick="cancelUpdate()">Cancel</button>
    <input type="submit" value="Update Record">
</form>
</div>
